---
title: é‡å­¦æ³›å‹
date: 2020-12-28 01:12:35
tags:
  - Android
  - Java
  - æ³›å‹ 
---

## ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ

- Javaæ³›å‹(generics)æ˜¯JDK5ä¸­å¼•å…¥çš„ä¸€ç§**å‚æ•°åŒ–ç±»å‹**ç‰¹æ€§

- Javaæ³›å‹(generics)æ˜¯JDK5ä¸­å¼•å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œæ³›å‹æä¾›äº†
  ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨æ£€æµ‹æœºåˆ¶ï¼Œ
  è¯¥æœºåˆ¶å…è®¸ç¨‹åºå‘˜åœ¨ç¼–è¯‘æ—¶æ£€æµ‹åˆ°éæ³•çš„ç±»å‹
  æ³›å‹çš„æœ¬è´¨æ˜¯å‚æ•°ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°
  æ³›å‹ä¸å­˜åœ¨äºJVMè™šæ‹Ÿæœº


## ä»€ä¹ˆæ˜¯å‚æ•°åŒ–ç±»å‹ï¼Ÿ

æŠŠç±»å‹å½“å‚æ•°ä¸€æ ·ä¼ é€’

æ•°æ®ç±»å‹åªèƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼ˆæ³›å‹çš„å‰¯ä½œç”¨ï¼‰

ä¸¾ä¸ªä¾‹å­ï¼š

- List<T>ä¸­çš„â€Tâ€ç§°ä¸º**ç±»å‹å‚æ•°**

- List<Person>ä¸­çš„"Person"ç§°ä¸º**å®é™…ç±»å‹å‚æ•°**

- "List<T>"æ•´ä¸ªæˆä¸º**æ³›å‹ç±»å‹**

- "List<Person>"æ•´ä¸ªç§°ä¸º**å‚æ•°åŒ–çš„ç±»å‹ParameterizedType**

  <!--more-->

## ä¸ºä»€ä¹ˆä½¿ç”¨æ³›å‹ï¼Œä½¿ç”¨æ³›å‹çš„å¥½å¤„ï¼Ÿ

1. ä»£ç æ›´å¥å£®ï¼ˆåªè¦ç¼–è¯‘æœŸæ²¡æœ‰è­¦å‘Šï¼Œé‚£ä¹ˆè¿è¡ŒæœŸå°±ä¸ä¼šå‡ºç°ClassCastExceptionï¼‰

```
//ä¸ä½¿ç”¨æ³›å‹ï¼Œè¿è¡ŒæœŸæŠ¥é”™
List list = new ArrayList(); 
list.add("hello");
Integer s = (String) list.get(0);// Causes a ClassCastException to be thrown.
```

```
//ä½¿ç”¨æ³›å‹ï¼Œç¼–è¯‘æœŸå°±æ£€æŸ¥
List<String> list = new ArrayList(); 
list.add("hello");
Integer s = (String) list.get(0);//ç¼–è¯‘å™¨å°±ä¼šä¸é€šè¿‡
```

2. ä»£ç æ›´ç®€æ´ï¼Œä¸ç”¨å¼ºè½¬

```
//ä¸ä½¿ç”¨æ³›å‹ï¼Œéœ€è¦å¼ºè½¬
List list = new ArrayList(); 
list.add("hello");
String s = (String) list.get(0);
```


```
//ä½¿ç”¨æ³›å‹ï¼Œä¸éœ€è¦å¼ºè½¬
List<String> list = new ArrayList<String>();
list.add("hello"); 
String s = list.get(0); // no cast
```

3. ä»£ç æ›´çµæ´»ï¼Œå¤ç”¨

```
 // java.util.Listä¸­çš„æ’åºæ–¹æ³•sortï¼Œåªè¦å®ç°äº†Comparatoræ¥å£çš„éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•
 default void sort(@Nullable Comparator<? super E> c) {
        throw new RuntimeException("Stub!");
    }
```

## Javaæ˜¯å¦‚ä½•å¤„ç†æ³›å‹çš„

1. é€šè¿‡è¿è¡Œæ—¶è·å–çš„ç±»ä¿¡æ¯æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚æ³›å‹ç±»å‹è¢«æ“¦é™¤äº†ï¼Œæ“¦é™¤ååªå‰©ä¸‹åŸå§‹ç±»å‹ï¼Œå¦‚ä¸‹é¢æ‰€ç¤ºçš„åªå‰©ä¸‹ArrayListç±»å‹ã€‚

```
 ArrayList<String> strings = new ArrayList<>();
 ArrayList<Integer> integers = new ArrayList<>();
 System.out.println(strings.getClass() == integers.getClass());
 //result true
```

### æ³›å‹æ“¦é™¤

- åŠŸèƒ½ï¼šä¿è¯äº†æ³›å‹ä¸åœ¨è¿è¡Œæ—¶å‡ºç°
- ç±»å‹æ¶ˆé™¤åº”ç”¨çš„åœºåˆï¼š 
  ç¼–è¯‘å™¨ä¼šæŠŠæ³›å‹ç±»å‹ä¸­æ‰€æœ‰çš„ç±»å‹å‚æ•°æ›¿æ¢ä¸ºå®ƒä»¬çš„ä¸Šï¼ˆä¸‹ï¼‰é™ï¼Œå¦‚æœæ²¡æœ‰å¯¹ç±»å‹å‚æ•°åšå‡ºé™åˆ¶ï¼Œé‚£ä¹ˆå°±æ›¿æ¢ä¸ºObjectç±»å‹ã€‚å› æ­¤ï¼Œç¼–è¯‘å‡ºçš„å­—èŠ‚ç ä»…ä»…åŒ…å«äº†å¸¸è§„ç±»ï¼Œæ¥å£å’Œæ–¹æ³•ã€‚
  åœ¨å¿…è¦æ—¶æ’å…¥ç±»å‹è½¬æ¢ä»¥ä¿æŒç±»å‹å®‰å…¨ã€‚
  ç”Ÿæˆæ¡¥æ–¹æ³•ä»¥åœ¨æ‰©å±•æ³›å‹æ—¶ä¿æŒå¤šæ€æ€§
- Bridge Methods æ¡¥æ–¹æ³•
  å½“ç¼–è¯‘ä¸€ä¸ªæ‰©å±•å‚æ•°åŒ–ç±»çš„ç±»ï¼Œæˆ–ä¸€ä¸ªå®ç°äº†å‚æ•°åŒ–æ¥å£çš„æ¥å£æ—¶ï¼Œç¼–è¯‘å™¨æœ‰å¯èƒ½å› æ­¤è¦åˆ›å»ºä¸€ä¸ªåˆæˆæ–¹æ³•ï¼Œåä¸ºæ¡¥æ–¹æ³•ã€‚å®ƒæ˜¯ç±»å‹æ“¦é™¤è¿‡ç¨‹ä¸­çš„ä¸€éƒ¨åˆ†


### ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­çœ‹ä¸€ä¸‹Javaæ˜¯æ€ä¹ˆå¤„ç†æ³›å‹çš„

1. å®šä¹‰ä¸€ä¸ªæ³›å‹æ¥å£
       

```
public interface Box<T> {
    void set(T t);
    T get();
}
```

2. åˆ©ç”¨*javac*å‘½ä»¤è·å–å­—èŠ‚ç æ–‡ä»¶

```
public interface Box<T> {
    void set(T var1);

    T get();
}
```

3. åˆ©ç”¨*javap -c*å‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„å­—èŠ‚ç ï¼Œæˆ‘ä»¬çš„Tå˜æˆäº†Objectç±»å‹ã€‚

```
public abstract interface test3/Box {
  public abstract set(Ljava/lang/Object;)V
  public abstract get()Ljava/lang/Object;
}

```

4. æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»å»å®ç°è¿™ä¸ªæ¥å£

```
public class ConditionalBox<T> implements Box<T> {

    private List<T> items = new ArrayList<T>(10);

    public ConditionalBox() {
    }

    @Override
    public void set(T t) {
        items.add(t);
    }

    @Override
    public T get() {
        int index = items.size() - 1;
        if (index >= 0) {
            return items.get(index);
        } else {
            return null;
        }
    }
}
```

5.ç”¨javap -cå‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„å­—èŠ‚ç ã€‚å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„setå’Œgetè¿˜æ˜¯æ„é€ æ–¹æ³•ï¼ŒTå˜æˆäº†Objectç±»å‹ã€‚
    

```
public class test3/ConditionalBox implements test3/Box {

  // compiled from: ConditionalBox.java

  // access flags 0x2
  // signature Ljava/util/List<TT;>;
  // declaration: items extends java.util.List<T>
  private Ljava/util/List; items

  // access flags 0x1
  public <init>()V
   L0
    LINENUMBER 10 L0
    ALOAD 0
    INVOKESPECIAL java/lang/Object.<init> ()V
   L1
    LINENUMBER 8 L1
    ALOAD 0
    NEW java/util/ArrayList
    DUP
    BIPUSH 10
    INVOKESPECIAL java/util/ArrayList.<init> (I)V
    PUTFIELD test3/ConditionalBox.items : Ljava/util/List;
   L2
    LINENUMBER 11 L2
    RETURN
   L3
    LOCALVARIABLE this Ltest3/ConditionalBox; L0 L3 0
    // signature Ltest3/ConditionalBox<TT;>;
    // declaration: this extends test3.ConditionalBox<T>
    MAXSTACK = 4
    MAXLOCALS = 1

  // access flags 0x1
  // signature (TT;)V
  // declaration: void set(T)
  public set(Ljava/lang/Object;)V
   L0
    LINENUMBER 15 L0
    ALOAD 0
    GETFIELD test3/ConditionalBox.items : Ljava/util/List;
    ALOAD 1
    INVOKEINTERFACE java/util/List.add (Ljava/lang/Object;)Z (itf)
    POP
   L1
    LINENUMBER 16 L1
    RETURN
   L2
    LOCALVARIABLE this Ltest3/ConditionalBox; L0 L2 0
    // signature Ltest3/ConditionalBox<TT;>;
    // declaration: this extends test3.ConditionalBox<T>
    LOCALVARIABLE t Ljava/lang/Object; L0 L2 1
    // signature TT;
    // declaration: t extends T
    MAXSTACK = 2
    MAXLOCALS = 2

  // access flags 0x1
  // signature ()TT;
  // declaration: T get()
  public get()Ljava/lang/Object;
   L0
    LINENUMBER 20 L0
    ALOAD 0
    GETFIELD test3/ConditionalBox.items : Ljava/util/List;
    INVOKEINTERFACE java/util/List.size ()I (itf)
    ICONST_1
    ISUB
    ISTORE 1
   L1
    LINENUMBER 21 L1
    ILOAD 1
    IFLT L2
   L3
    LINENUMBER 22 L3
    ALOAD 0
    GETFIELD test3/ConditionalBox.items : Ljava/util/List;
    ILOAD 1
    INVOKEINTERFACE java/util/List.get (I)Ljava/lang/Object; (itf)
    ARETURN
   L2
    LINENUMBER 24 L2
   FRAME APPEND [I]
    ACONST_NULL
    ARETURN
   L4
    LOCALVARIABLE this Ltest3/ConditionalBox; L0 L4 0
    // signature Ltest3/ConditionalBox<TT;>;
    // declaration: this extends test3.ConditionalBox<T>
    LOCALVARIABLE index I L1 L4 1
    MAXSTACK = 2
    MAXLOCALS = 2
}
```

6. IntelligentBox<T extends Comparable<T>>å®ç°Boxæ¥å£ã€‚ä»£ç å¦‚ä¸‹

```
public class IntelligentBox<T extends Comparable<T>> implements Box<T> {

    private List<T> items = new ArrayList<T>(10);

    @Override
    public void set(T t) {
        items.add(t);
        Collections.sort(items);
    }

    @Override
    public T get() {
        int index = items.size() - 1;
        if (index >= 0) {
            return items.get(index);
        } else {
            return null;
        }
    }
}

```

7. ç”¨javap -cå‘½ä»¤æŸ¥çœ‹IntelligentBoxç”Ÿæˆçš„å­—èŠ‚ç 

```
public class test3/IntelligentBox implements test3/Box {

  // compiled from: IntelligentBox.java

  // access flags 0x2
  // signature Ljava/util/List<TT;>;
  // declaration: items extends java.util.List<T>
  private Ljava/util/List; items

  // access flags 0x1
  public <init>()V
   L0
    LINENUMBER 7 L0
    ALOAD 0
    INVOKESPECIAL java/lang/Object.<init> ()V
   L1
    LINENUMBER 9 L1
    ALOAD 0
    NEW java/util/ArrayList
    DUP
    BIPUSH 10
    INVOKESPECIAL java/util/ArrayList.<init> (I)V
    PUTFIELD test3/IntelligentBox.items : Ljava/util/List;
    RETURN
   L2
    LOCALVARIABLE this Ltest3/IntelligentBox; L0 L2 0
    // signature Ltest3/IntelligentBox<TT;>;
    // declaration: this extends test3.IntelligentBox<T>
    MAXSTACK = 4
    MAXLOCALS = 1

  // access flags 0x1
  // signature (TT;)V
  // declaration: void set(T)
  public set(Ljava/lang/Comparable;)V
   L0
    LINENUMBER 13 L0
    ALOAD 0
    GETFIELD test3/IntelligentBox.items : Ljava/util/List;
    ALOAD 1
    INVOKEINTERFACE java/util/List.add (Ljava/lang/Object;)Z (itf)
    POP
   L1
    LINENUMBER 14 L1
    ALOAD 0
    GETFIELD test3/IntelligentBox.items : Ljava/util/List;
    INVOKESTATIC java/util/Collections.sort (Ljava/util/List;)V
   L2
    LINENUMBER 15 L2
    RETURN
   L3
    LOCALVARIABLE this Ltest3/IntelligentBox; L0 L3 0
    // signature Ltest3/IntelligentBox<TT;>;
    // declaration: this extends test3.IntelligentBox<T>
    LOCALVARIABLE t Ljava/lang/Comparable; L0 L3 1
    // signature TT;
    // declaration: t extends T
    MAXSTACK = 2
    MAXLOCALS = 2

  // access flags 0x1
  // signature ()TT;
  // declaration: T get()
  public get()Ljava/lang/Comparable;
   L0
    LINENUMBER 19 L0
    ALOAD 0
    GETFIELD test3/IntelligentBox.items : Ljava/util/List;
    INVOKEINTERFACE java/util/List.size ()I (itf)
    ICONST_1
    ISUB
    ISTORE 1
   L1
    LINENUMBER 20 L1
    ILOAD 1
    IFLT L2
   L3
    LINENUMBER 21 L3
    ALOAD 0
    GETFIELD test3/IntelligentBox.items : Ljava/util/List;
    ILOAD 1
    INVOKEINTERFACE java/util/List.get (I)Ljava/lang/Object; (itf)
    CHECKCAST java/lang/Comparable
    ARETURN
   L2
    LINENUMBER 23 L2
   FRAME APPEND [I]
    ACONST_NULL
    ARETURN
   L4
    LOCALVARIABLE this Ltest3/IntelligentBox; L0 L4 0
    // signature Ltest3/IntelligentBox<TT;>;
    // declaration: this extends test3.IntelligentBox<T>
    LOCALVARIABLE index I L1 L4 1
    MAXSTACK = 2
    MAXLOCALS = 2

  // access flags 0x1041
  public synthetic bridge get()Ljava/lang/Object;
   L0
    LINENUMBER 7 L0
    ALOAD 0
    INVOKEVIRTUAL test3/IntelligentBox.get ()Ljava/lang/Comparable;
    ARETURN
   L1
    LOCALVARIABLE this Ltest3/IntelligentBox; L0 L1 0
    // signature Ltest3/IntelligentBox<TT;>;
    // declaration: this extends test3.IntelligentBox<T>
    MAXSTACK = 1
    MAXLOCALS = 1

  // access flags 0x1041
  public synthetic bridge set(Ljava/lang/Object;)V
   L0
    LINENUMBER 7 L0
    ALOAD 0
    ALOAD 1
    CHECKCAST java/lang/Comparable
    INVOKEVIRTUAL test3/IntelligentBox.set (Ljava/lang/Comparable;)V
    RETURN
   L1
    LOCALVARIABLE this Ltest3/IntelligentBox; L0 L1 0
    // signature Ltest3/IntelligentBox<TT;>;
    // declaration: this extends test3.IntelligentBox<T>
    MAXSTACK = 2
    MAXLOCALS = 2
}

```


- å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸¤å¤„åœ°æ–¹è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œåˆ†åˆ«æ˜¯getå’Œsetæ–¹æ³•ã€‚

```
 INVOKEINTERFACE java/util/List.get (I)Ljava/lang/Object; (itf)
CHECKCAST java/lang/Comparable
```


```
CHECKCAST java/lang/Comparable
INVOKEVIRTUAL test3/IntelligentBox.set (Ljava/lang/Comparable;)V
```

- å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªæ¡¥æ–¹æ³•

```
  public synthetic bridge set(Ljava/lang/Object;)V
  public synthetic bridge get()Ljava/lang/Object;
```

- ç”¨ä¼ªä»£ç æ¥è¡¨ç¤ºIntelligentBoxçš„è¿‡ç¨‹

```
public class test3/IntelligentBox implements test3/Box {
    public void set(Comparable t) { /* compiled code */ }

    public Comparable get() { /* compiled code */ }
	
	@Overide
	public synthetic bridge get(){
	}
	
	@Overide
	public synthetic bridge set(Object t){
	    set((Comparable)t)
	}
}
```

### æ³›å‹æ“¦é™¤çš„æ®‹ç•™

çœ‹ä¸€ä¸‹Boxçš„å­—èŠ‚ç æ–‡ä»¶Box.classå’ŒæŸ¥çœ‹ç”Ÿæˆçš„å­—èŠ‚ç 

```
public interface Box<T> {
    void set(T var1);
    T get();
}

```

- ç–‘é—®ï¼šä¸æ˜¯ç±»å‹æ“¦é™¤ä¹‹åå˜æˆObjectäº†å—ï¼Ÿæ€ä¹ˆè¿™é‡Œå­—èŠ‚ç æ–‡ä»¶è¿˜æ˜¯Tç±»å‹ï¼Ÿå…¶å®è¿™é‡Œçœ‹åˆ°çš„å…¶å®æ˜¯ç­¾åè€Œå·²ï¼Œè¿˜ä¿ç•™å®šä¹‰çš„æ ¼å¼ï¼Œå¯¹äºåˆ†æå­—èŠ‚ç æœ‰å¥½å¤„ã€‚å¹¶ä¸æ˜¯çœŸçš„æ“¦é™¤äº†ï¼Œä¿å­˜åœ¨ç±»çš„å¸¸é‡æ± ä¸­ã€‚

```
/**
 * ParameterizedType
 * å…·ä½“çš„èŒƒå‹ç±»å‹, å¦‚Map<String, String>
 * æœ‰å¦‚ä¸‹æ–¹æ³•:
 *
 * Type getRawType(): è¿”å›æ‰¿è½½è¯¥æ³›å‹ä¿¡æ¯çš„å¯¹è±¡, å¦‚ä¸Šé¢é‚£ä¸ªMap<String, String>æ‰¿è½½èŒƒå‹ä¿¡æ¯çš„å¯¹è±¡æ˜¯Map
 * Type[] getActualTypeArguments(): è¿”å›å®é™…æ³›å‹ç±»å‹åˆ—è¡¨, å¦‚ä¸Šé¢é‚£ä¸ªMap<String, String>å®é™…èŒƒå‹åˆ—è¡¨ä¸­æœ‰ä¸¤ä¸ªå…ƒç´ , éƒ½æ˜¯String
 * Type getOwnerType(): è¿”å›æ˜¯è°çš„member.(ä¸Šé¢é‚£ä¸¤ä¸ªæœ€å¸¸ç”¨)
 */
public class TestType {
    Map<String, String> map;
    //æ“¦é™¤ å…¶å®åœ¨ç±»å¸¸é‡æ± é‡Œé¢ä¿ç•™äº†æ³›å‹ä¿¡æ¯
    public static void main(String[] args) throws Exception {
        Field f = TestType.class.getDeclaredField("map");
        System.out.println(f.getGenericType());                               // java.util.Map<java.lang.String, java.lang.String>
        System.out.println(f.getGenericType() instanceof ParameterizedType);  // true
        ParameterizedType pType = (ParameterizedType) f.getGenericType();
        System.out.println(pType.getRawType());                               // interface java.util.Map
        for (Type type : pType.getActualTypeArguments()) {
            System.out.println(type);                                         // æ‰“å°ä¸¤é: class java.lang.String
        }
        System.out.println(pType.getOwnerType());                             // null
    }
}

```

- javaè™šæ‹Ÿæœºè§„èŒƒä¸­ä¸ºäº†å“åº”åœ¨æ³›å‹ç±»ä¸­å¦‚ä½•è·å–ä¼ å…¥çš„å‚æ•°åŒ–ç±»å‹ç­‰é—®é¢˜ï¼Œå¼•å…¥äº†signatureï¼ŒLocalVariableTypeTableç­‰æ–°çš„å±æ€§æ¥è®°å½•æ³›å‹ä¿¡æ¯ï¼Œæ‰€ä»¥æ‰€è°“çš„æ³›å‹ç±»å‹æ“¦é™¤ï¼Œä»…ä»…æ˜¯å¯¹æ–¹æ³•çš„codeå±æ€§ä¸­çš„å­—èŠ‚ç è¿›è¡Œæ“¦é™¤ï¼Œè€ŒåŸæ•°æ®ä¸­è¿˜æ˜¯ä¿ç•™äº†æ³›å‹ä¿¡æ¯çš„ï¼Œè¿™äº›ä¿¡æ¯è¢«ä¿å­˜åœ¨classå­—èŠ‚ç çš„å¸¸é‡æ± ä¸­ï¼Œä½¿ç”¨äº†æ³›å‹çš„ä»£ç è°ƒç”¨å¤„ä¼šç”Ÿæˆä¸€ä¸ªsignatureç­¾åå­—æ®µï¼ŒsignatureæŒ‡æ˜äº†è¿™ä¸ªå¸¸é‡åœ¨å¸¸é‡æ± çš„åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ‰¾åˆ°äº†å‚æ•°åŒ–ç±»å‹ã€‚è¿™æ ·æˆ‘ä»¬ä¹ŸçŸ¥é“ **ç°åœ¨å°±æ˜ç™½äº†æ³›å‹æ“¦é™¤ä¸æ˜¯æ“¦é™¤å…¨éƒ¨**

### æ€»ç»“

- QUESTION:Javaæ³›å‹çš„åŸç†ï¼Ÿä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤æœºåˆ¶ï¼Ÿ
- ANSWER:Javaçš„æ³›å‹æ˜¯JDK5æ–°å¼•å…¥çš„ç‰¹æ€§ï¼Œä¸ºäº†å‘ä¸‹å…¼å®¹ï¼Œè™šæ‹Ÿæœºå…¶å®æ˜¯ä¸æ”¯æŒæ³›å‹ï¼Œæ‰€ä»¥Javaå®ç°çš„æ˜¯ä¸€ç§**ä¼ªæ³›å‹**æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´Javaåœ¨ç¼–è¯‘æœŸæ“¦é™¤äº†æ‰€æœ‰çš„æ³›å‹ä¿¡æ¯ï¼Œè¿™æ ·Javaå°±ä¸éœ€è¦äº§ç”Ÿæ–°çš„ç±»å‹åˆ°å­—èŠ‚ç ï¼Œæ‰€æœ‰çš„æ³›å‹ç±»å‹æœ€ç»ˆéƒ½æ˜¯ä¸€ç§åŸå§‹ç±»å‹ï¼Œåœ¨Javaè¿è¡Œæ—¶æ ¹æœ¬å°±ä¸å­˜åœ¨æ³›å‹ä¿¡æ¯ã€‚

- QUESTION:Javaç¼–è¯‘å™¨å…·ä½“æ˜¯å¦‚ä½•æ“¦é™¤æ³›å‹çš„
- ANSWER: 
  1. æ£€æŸ¥æ³›å‹ç±»å‹ï¼Œè·å–ç›®æ ‡ç±»å‹
  2. æ“¦é™¤ç±»å‹å˜é‡ï¼Œå¹¶æ›¿æ¢ä¸ºé™å®šç±»å‹
     å¦‚æœæ³›å‹ç±»å‹çš„ç±»å‹å˜é‡æ²¡æœ‰é™å®š(<T>),åˆ™ç”¨Objectä½œä¸ºåŸå§‹ç±»å‹ã€‚å¦‚æœæœ‰é™å®š(<T extends XClass>),åˆ™ç”¨XClassä½œä¸ºåŸå§‹ç±»å‹å¦‚æœæœ‰å¤šä¸ªé™å®š(T extends XClass1&XClass2),åˆ™ä½¿ç”¨ç¬¬ä¸€ä¸ªè¾¹ç•ŒXClass1ä½œä¸ºåŸå§‹ç±»
  3. åœ¨å¿…è¦æ—¶æ’å…¥ç±»å‹è½¬æ¢ä»¥ä¿æŒç±»å‹å®‰å…¨
  4. ç”Ÿæˆæ¡¥æ–¹æ³•ä»¥åœ¨æ‰©å±•æ—¶ä¿æŒå¤šæ€æ€§

## ä½¿ç”¨æ³›å‹ä»¥åŠæ³›å‹æ“¦é™¤å¸¦æ¥çš„å½±å“(å‰¯ä½œç”¨)

### æ³›å‹ç±»å‹å˜é‡ä¸èƒ½ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹

æ¯”å¦‚æ²¡æœ‰ArrayList<int>,åªæœ‰ArrayList<Integer>.å½“ç±»å‹æ“¦é™¤åï¼ŒArrayListçš„åŸå§‹ç±»ä¸­çš„ç±»å‹å˜é‡(T)æ›¿æ¢æˆObject,ä½†Objectç±»å‹ä¸èƒ½å­˜æ”¾intå€¼


```
//erroræŠ¥é”™ï¼Œå› ä¸ºæ“¦é™¤åå˜æˆäº†Objectï¼Œè€ŒObjectæ˜¯æ— æ³•å­˜æ”¾int
ArrayList<int> ints = new ArrayList<int>();
ArrayList<Integer> integerArrayList = new ArrayList<Integer>();
```

### ä¸èƒ½ä½¿ç”¨instanceof è¿ç®—ç¬¦

å› ä¸ºæ“¦é™¤åï¼ŒArrayList<String>åªå‰©ä¸‹åŸå§‹ç±»å‹ï¼Œæ³›å‹ä¿¡æ¯Stringä¸å­˜åœ¨äº†ï¼Œæ‰€æœ‰æ²¡æ³•ä½¿ç”¨instanceof

```
ArrayList<String> stringArrayList = new ArrayList<String>();
//ä½¿ç”¨ArrayList<?>å¯ä»¥
if (stringArrayList instanceof ArrayList<?>){
            
}
//å› ä¸ºæ“¦é™¤ArrayList<String>åStringä¸¢å¤±äº†
if (stringArrayList instanceof ArrayList<String>){

}
```

### æ³›å‹åœ¨é™æ€æ–¹æ³•å’Œé™æ€ç±»ä¸­çš„é—®é¢˜

å› ä¸ºæ³›å‹ç±»ä¸­çš„æ³›å‹å‚æ•°çš„å®ä¾‹åŒ–æ˜¯åœ¨å®šä¹‰æ³›å‹ç±»å‹å¯¹è±¡
(æ¯”å¦‚ArrayList<Integer>)çš„æ—¶å€™æŒ‡å®šçš„ï¼Œè€Œé™æ€æˆå‘˜æ˜¯ä¸éœ€è¦ä½¿ç”¨å¯¹è±¡æ¥è°ƒç”¨çš„ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ²¡åˆ›å»ºï¼Œå¦‚ä½•ç¡®å®šè¿™ä¸ªæ³›å‹å‚æ•°æ˜¯ä»€ä¹ˆ


```
//ä¸‹é¢ä¸¤ä¸ªä¼šæŠ¥é”™ï¼Œå› ä¸ºæ³›å‹å‚æ•°æ˜¯è¦åˆ›å»ºå¯¹è±¡æ—¶ç¡®å®š
public static T a;
public static T test1(T t) {
}

//è¿™é‡Œä¸æŠ¥é”™ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œæ­¤Téå½¼T test2(T t)çš„T
public static <T> T test2(T t) {
    return t;
}
```

### æ³›å‹ç±»å‹ä¸­çš„æ–¹æ³•å†²çª

å› ä¸ºæ“¦é™¤åä¸¤ä¸ªequalsæ–¹æ³•å˜æˆä¸€æ ·çš„äº†


```
//æ–¹æ³•å†²çªï¼Œå› ä¸ºæ“¦é™¤åå˜ä¸€æ ·äº†
@Override
public boolean equals(T obj) {
    return super.equals(obj);
}

@Override
public boolean equals(Object obj) {
    return super.equals(obj);
}
```

### æ²¡æ³•åˆ›å»ºæ³›å‹å®ä¾‹

å› ä¸ºç±»å‹ä¸ç¡®å®š


```
class Test02 {
   //æ— æ³•åˆ›å»ºä¸€ä¸ªç±»å‹å‚æ•°çš„å®ä¾‹ã€‚ä¸‹é¢ä¼šæŠ¥é”™
   public static <E> void append(List<E> list) {
      //  E elem = new E();  // compile-time error
      //  list.add(elem);
   }
   //é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªå‚æ•°åŒ–ç±»å‹çš„å®ä¾‹
   public static <E> void append(List<E> list, Class<E> cls) throws Exception {
       E elem = cls.newInstance();   // OK
       list.add(elem);
   }
}
```

### æ²¡æœ‰æ³›å‹æ•°ç»„

å› ä¸ºæ•°ç»„æ˜¯åå˜ï¼Œæ“¦é™¤åå°±æ²¡æ³•æ»¡è¶³æ•°ç»„åå˜çš„åŸåˆ™


```
//        Plate<Apple>[] applePlates = new Plate<Apple>[10];//ä¸å…è®¸
//        T[] arr = new T[10];//ä¸å…è®¸
       Apple[] apples = new Apple[10];
       Fruit[] fruits = new Fruit[10];
        System.out.println(apples.getClass());
        //class [Lcom.zero.genericsdemo02.demo02.Apple;
        System.out.println(fruits.getClass());
        //class [Lcom.zero.genericsdemo02.demo02.Fruit;
       fruits = apples;
       // fruitsé‡Œé¢åŸæœ¬æ˜¯æ”¾ä»€ä¹ˆç±»å‹çš„ï¼Ÿ Fruit or Apple
        // Apple[]
       fruits[0] = new Banana();//ç¼–è¯‘é€šè¿‡ï¼Œè¿è¡ŒæŠ¥ArrayStoreException
        //Fruitæ˜¯Appleçš„çˆ¶ç±»ï¼ŒFruit[]æ˜¯Apple[]çš„çˆ¶ç±»ï¼Œè¿™å°±æ˜¯æ•°ç»„çš„åå˜
        //å¦‚æœåŠ å…¥æ³›å‹åï¼Œç”±äºæ“¦é™¤æœºåˆ¶ï¼Œè¿è¡Œæ—¶å°†æ— æ³•çŸ¥é“æ•°ç»„çš„ç±»å‹
        Plate<?>[] plates = new Plate<?>[10];//è¿™æ˜¯å¯ä»¥çš„
```

## æ³›å‹ï¼Œç»§æ‰¿å’Œå­ç±»å‹

ç»™å®šä¸¤ç§å…·ä½“çš„ç±»å‹Aå’ŒB(ä¾‹å¦‚Fruitå’ŒApple),
æ— è®ºAå’ŒBæ˜¯å¦ç›¸å…³ï¼Œ
MyClass<A>ä¸MyClass<B>éƒ½æ²¡åŠæ¯›é’±å…³ç³»ï¼Œ
å®ƒä»¬çš„å…¬å…±çˆ¶å¯¹è±¡æ˜¯Object


## æ³›å‹PECSåŸåˆ™


- å¦‚æœä½ åªéœ€è¦ä»é›†åˆä¸­è·å¾—ç±»å‹T , ä½¿ç”¨<? extends T>é€šé…ç¬¦
- å¦‚æœä½ åªéœ€è¦å°†ç±»å‹Tæ”¾åˆ°é›†åˆä¸­, ä½¿ç”¨<? super T>é€šé…ç¬¦
- å¦‚æœä½ æ—¢è¦è·å–åˆè¦æ”¾ç½®å…ƒç´ ï¼Œåˆ™ä¸ä½¿ç”¨ä»»ä½•é€šé…ç¬¦ã€‚ä¾‹å¦‚List<Apple>
- PECSå³ Producer extends Consumer superï¼Œ ä¸ºäº†ä¾¿äºè®°å¿†ã€‚
- ä¸ºä½•è¦PECSåŸåˆ™ï¼Ÿæå‡äº†APIçš„çµæ´»æ€§
- <?>  æ—¢ä¸èƒ½å­˜ä¹Ÿä¸èƒ½å–


åœ¨æ³›å‹ç¼–ç¨‹æ—¶ï¼Œä½¿ç”¨éƒ¨åˆ†é™å®šçš„å½¢å‚æ—¶ï¼Œ<? super T>å’Œ<? extends T>çš„ä½¿ç”¨åœºæ™¯å®¹æ˜“æ··æ·†ï¼Œ PECSåŸåˆ™å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¾ˆå¥½è®°ä½å®ƒä»¬ï¼šæä¾›è€…ï¼ˆProviderï¼‰ä½¿ç”¨extendsï¼Œæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ ä½¿ç”¨superã€‚é€šä¿—åœ°è¯´ï¼Œ ProvideræŒ‡çš„å°±æ˜¯è¯¥å®¹å™¨ä»è‡ªå·±çš„å®¹å™¨é‡Œæä¾›Tç±»å‹æˆ–Tçš„å­ç±»å‹çš„å¯¹è±¡ä¾›åˆ«äººä½¿ç”¨ï¼› ConsumeræŒ‡çš„å°±æ˜¯è¯¥å®¹å™¨æŠŠä»åˆ«å¤„æ‹¿åˆ°çš„Tç±»å‹æˆ–Tçš„å­ç±»å‹çš„å¯¹è±¡æ”¾åˆ°è‡ªå·±çš„å®¹å™¨ã€‚


## Kotlinçš„æ³›å‹

- ä½¿ç”¨å…³é”®å­— out æ¥æ”¯æŒåå˜ï¼Œç­‰åŒäº Java ä¸­çš„ä¸Šç•Œé€šé…ç¬¦ ? extendsã€‚
- ä½¿ç”¨å…³é”®å­— in æ¥æ”¯æŒé€†å˜ï¼Œç­‰åŒäº Java ä¸­çš„ä¸‹ç•Œé€šé…ç¬¦ ? superã€‚


``` 
var textViews: List<out TextView>
var textViews: List<in TextView>
```

### å£°æ˜å¤„çš„ out å’Œ in

Kotlin æä¾›äº†å¦å¤–ä¸€ç§å†™æ³•ï¼šå¯ä»¥åœ¨å£°æ˜ç±»çš„æ—¶å€™ï¼Œç»™æ³›å‹ç¬¦å·åŠ ä¸Š out å…³é”®å­—ï¼Œè¡¨æ˜æ³›å‹å‚æ•° T åªä¼šç”¨æ¥è¾“å‡ºï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™å°±ä¸ç”¨é¢å¤–åŠ  out äº†ã€‚

```
class Producer<out T> {
    fun produce(): T {
        ...
    }
}

val producer: Producer<TextView> = Producer<Button>() // ğŸ‘ˆ è¿™é‡Œä¸å†™ out ä¹Ÿä¸ä¼šæŠ¥é”™
val producer: Producer<out TextView> = Producer<Button>() // ğŸ‘ˆ out å¯ä»¥ä½†æ²¡å¿…è¦
```

### whereå…³é”®å­—

Java ä¸­å£°æ˜ç±»æˆ–æ¥å£çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ extends æ¥è®¾ç½®è¾¹ç•Œï¼Œå°†æ³›å‹ç±»å‹å‚æ•°é™åˆ¶ä¸ºæŸä¸ªç±»å‹çš„å­é›†ï¼ŒåŒæ—¶è¿™ä¸ªè¾¹ç•Œæ˜¯å¯ä»¥è®¾ç½®å¤šä¸ªï¼Œç”¨ & ç¬¦å·è¿æ¥ï¼š

```
//T çš„ç±»å‹å¿…é¡»åŒæ—¶æ˜¯ B å’Œ C çš„å­ç±»å‹
class A<T extends B & C>{ 
}
```

åœ¨Kotlinä¸­

```
//T çš„ç±»å‹å¿…é¡»åŒæ—¶æ˜¯ B å’Œ C çš„å­ç±»å‹
class A<T> where T : B, T : C

```

### reifiedå…³é”®å­—

```
inline fun <reified T> printIfTypeMatch(item: Any) {
    if (item is T) { // ğŸ‘ˆ è¿™é‡Œå°±ä¸ä¼šåœ¨æç¤ºé”™è¯¯äº†
        println(item)
    }
}
```



###  Kotlin æ³›å‹ä¸ Java æ³›å‹ä¸ä¸€è‡´çš„åœ°æ–¹

1. Java é‡Œçš„æ•°ç»„æ˜¯æ”¯æŒåå˜çš„ï¼Œè€Œ Kotlin ä¸­çš„æ•°ç»„ Array ä¸æ”¯æŒåå˜ã€‚

è¿™æ˜¯å› ä¸ºåœ¨ Kotlin ä¸­æ•°ç»„æ˜¯ç”¨ Array ç±»æ¥è¡¨ç¤ºçš„ï¼Œè¿™ä¸ª Array ç±»ä½¿ç”¨æ³›å‹å°±å’Œé›†åˆç±»ä¸€æ ·ï¼Œæ‰€ä»¥ä¸æ”¯æŒåå˜ã€‚

2. Java ä¸­çš„ List æ¥å£ä¸æ”¯æŒåå˜ï¼Œè€Œ Kotlin ä¸­çš„ List æ¥å£æ”¯æŒåå˜ã€‚

Java ä¸­çš„ List ä¸æ”¯æŒåå˜ï¼ŒåŸå› åœ¨ä¸Šæ–‡å·²ç»è®²è¿‡äº†ï¼Œéœ€è¦ä½¿ç”¨æ³›å‹é€šé…ç¬¦æ¥è§£å†³ã€‚

åœ¨ Kotlin ä¸­ï¼Œå®é™…ä¸Š MutableList æ¥å£æ‰ç›¸å½“äº Java çš„ Listã€‚Kotlin ä¸­çš„ List æ¥å£å®ç°äº†åªè¯»æ“ä½œï¼Œæ²¡æœ‰å†™æ“ä½œï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ç±»å‹å®‰å…¨ä¸Šçš„é—®é¢˜ï¼Œè‡ªç„¶å¯ä»¥æ”¯æŒåå˜ã€‚





## é¢è¯•å¸¸é—®

1. Arrayä¸­å¯ä»¥ç”¨æ³›å‹å—?

ç­”ï¼šä¸èƒ½

2. æ³›å‹ç±»å‹å¼•ç”¨ä¼ é€’é—®é¢˜

é—®ï¼šä½ å¯ä»¥æŠŠList<String>ä¼ é€’ç»™ä¸€ä¸ªæ¥å—List<Object>å‚æ•°çš„æ–¹æ³•å—ï¼Ÿ

ArrayList<String> arrayList1=new ArrayList<Object>();
ArrayList<Object> arrayList1=new ArrayList<String>();

ç­”ï¼šä¸èƒ½ã€‚æ²¡æœ‰åŠæ¯›é’±å…³ç³»

3. Javaä¸­List<?>å’ŒList<Object>ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?
   ç­”ï¼š

- List ï¼šå®Œå…¨æ²¡æœ‰ç±»å‹é™åˆ¶å’Œèµ‹å€¼é™å®šã€‚
- List<Object> ï¼šçœ‹ä¼¼ç”¨æ³•ä¸Listä¸€æ ·ï¼Œä½†æ˜¯åœ¨æ¥å—å…¶ä»–æ³›å‹èµ‹å€¼æ—¶ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚
- List<?>ï¼šæ˜¯ä¸€ä¸ªæ³›å‹ï¼Œåœ¨æ²¡æœ‰èµ‹å€¼å‰ï¼Œè¡¨ç¤ºå¯ä»¥æ¥å—ä»»ä½•ç±»å‹çš„é›†åˆèµ‹å€¼ï¼Œä½†èµ‹å€¼ä¹‹åä¸èƒ½å¾€é‡Œé¢éšä¾¿æ·»åŠ å…ƒç´ ï¼Œä½†å¯ä»¥removeå’Œclearï¼Œå¹¶éimmutable(ä¸å¯å˜)é›†åˆã€‚List<?>ä¸€èˆ¬ä½œä¸ºå‚æ•°æ¥æ¥æ”¶å¤–éƒ¨é›†åˆï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªå…·ä½“å…ƒç´ ç±»å‹çš„é›†åˆï¼Œä¹Ÿç§°ä¸ºé€šé…ç¬¦é›†åˆã€‚


4. ä»€ä¹ˆæ˜¯æ³›å‹ä¸­çš„é™å®šé€šé…ç¬¦å’Œéé™å®šé€šé…ç¬¦ ?

ç­”ï¼š

- é™å®šé€šé…ç¬¦<? extends T> <? super T>
- éé™å®šé€šé…ç¬¦<?>

5.æ³›å‹ç±»å‹å˜é‡ä¸èƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹

```
//error
ArrayList<double> arr1 = new ArrayList<>();
ArrayList<Double> arr2 = new ArrayList<>();
```

6. è¿è¡Œæ—¶ç±»å‹æŸ¥è¯¢


```
ArrayList<String> arrayList=new ArrayList<String>();
if( arrayList instanceof ArrayList<String>) //æ“¦é™¤
if( arrayList instanceof ArrayList<?>)  

```

7. Java çš„æ³›å‹æœ¬èº«æ˜¯ä¸æ”¯æŒåå˜å’Œé€†å˜çš„

- å¯ä»¥ä½¿ç”¨æ³›å‹é€šé…ç¬¦ ? extends æ¥ä½¿æ³›å‹æ”¯æŒåå˜ï¼Œä½†æ˜¯ã€Œåªèƒ½è¯»å–ä¸èƒ½ä¿®æ”¹ã€ï¼Œè¿™é‡Œçš„ä¿®æ”¹ä»…æŒ‡å¯¹æ³›å‹é›†åˆæ·»åŠ å…ƒç´ ï¼Œå¦‚æœæ˜¯ remove(int index) ä»¥åŠ clear å½“ç„¶æ˜¯å¯ä»¥çš„ã€‚
- å¯ä»¥ä½¿ç”¨æ³›å‹é€šé…ç¬¦ ? super æ¥ä½¿æ³›å‹æ”¯æŒé€†å˜ï¼Œä½†æ˜¯ã€Œåªèƒ½ä¿®æ”¹ä¸èƒ½è¯»å–ã€ï¼Œè¿™é‡Œè¯´çš„ä¸èƒ½è¯»å–æ˜¯æŒ‡ä¸èƒ½æŒ‰ç…§æ³›å‹ç±»å‹è¯»å–ï¼Œä½ å¦‚æœæŒ‰ç…§ Object è¯»å‡ºæ¥å†å¼ºè½¬å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

8. Javaä¸­æ•°ç»„æ˜¯åå˜çš„